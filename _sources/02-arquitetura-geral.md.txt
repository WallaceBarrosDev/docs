# 2. Arquitetura Geral

## 3.1 VisÃ£o Geral 

A arquitetura do sistema foi projetada para ser **clara**, **modular**, **segura** e **fÃ¡cil de manter**, atendendo tanto leitores nÃ£o tÃ©cnicos quanto desenvolvedores que darÃ£o manutenÃ§Ã£o no futuro.

Abaixo estÃ¡ o diagrama geral simplificado, seguido dos diagramas complementares e um Sequence Diagram separado, tudo com descriÃ§Ãµes reduzidas para nÃ£o gerar bugs no Mermaid.

---

## 3.2 Diagrama Geral 

```{mermaid}
graph TD

subgraph Cliente
    Browser["ğŸ§‘â€ğŸ’» Navegador"]
end

subgraph Frontend["Frontend - React + TS"]
    ReactApp["âš›ï¸ React App"]
    ApiClient["ğŸŒ API Client"]
end

subgraph Backend["API Interna - Node/Express"]
    InternalAPI["ğŸ”§ API Interna"]
    Auth["ğŸ” Auth"]
    Cache(("âš¡ Cache")) 
    InternalDB(("ğŸ—„ï¸ DB Interno")) 
    DataBridge["ğŸ”— API Externa"]
end

subgraph Externa["Sistema Local"]
    LocalAPI["ğŸ§© API Local"]
    LocalDB(("ğŸ—„ï¸ DB Externo")) 
end

Browser --> ReactApp
ReactApp --> ApiClient
ApiClient --> InternalAPI
InternalAPI --> Auth
InternalAPI --> Cache
InternalAPI --> InternalDB
InternalAPI --> DataBridge
DataBridge --> LocalAPI
LocalAPI --> LocalDB

%% ==== Estilos padronizados ====
%% Tipos:
%% - user: nÃ³s de usuÃ¡rio/cliente
%% - frontend: app React / client-side
%% - backend: API interna / DataBridge
%% - external: sistemas externos / APIs locais
%% - db: bancos (interno e externo)
%% - cache: camada de cache
%% - auth: autenticaÃ§Ã£o/autorizaÃ§Ã£o

classDef user fill:#f5f5f5,stroke:#333,color:#000;
classDef frontend fill:#61dafb,stroke:#333,color:#000;
classDef backend fill:#68a063,stroke:#333,color:#000;
classDef external fill:#4479a1,stroke:#333,color:#fff;
classDef db fill:#6c5ce7,stroke:#333,color:#fff;
classDef cache fill:#ff6b6b,stroke:#333,color:#000;
classDef auth fill:#fdd835,stroke:#333,color:#000;

%% AplicaÃ§Ã£o das classes
class Browser user;
class ReactApp,ApiClient frontend;
class InternalAPI,DataBridge backend;
class LocalAPI external;
class InternalDB,LocalDB db;
class Cache cache;
class Auth auth;
```

## 3.3 Diagramas Menores Complementares


ğŸ”¹ 1. Fluxo UsuÃ¡rio â†’ Frontend

```{mermaid}
flowchart LR
    U["ğŸ§‘â€ğŸ’» UsuÃ¡rio"] --> FE["âš›ï¸ Frontend"]
    FE --> U

%% Estilos padronizados (mesma paleta do diagrama geral)
classDef user fill:#f5f5f5,stroke:#333,color:#000;
classDef frontend fill:#61dafb,stroke:#333,color:#000;
classDef backend fill:#68a063,stroke:#333,color:#000;
classDef external fill:#4479a1,stroke:#333,color:#fff;
classDef db fill:#6c5ce7,stroke:#333,color:#fff;
classDef cache fill:#ff6b6b,stroke:#333,color:#000;
classDef auth fill:#fdd835,stroke:#333,color:#000;

class U user;
class FE frontend;
```

ğŸ”¹ 2. Frontend â†’ Backend

```{mermaid}
flowchart LR
    FE["âš›ï¸ Frontend"] --> API["ğŸ”§ Backend"]
    API --> FE

%% Estilos padronizados
classDef user fill:#f5f5f5,stroke:#333,color:#000;
classDef frontend fill:#61dafb,stroke:#333,color:#000;
classDef backend fill:#68a063,stroke:#333,color:#000;
classDef external fill:#4479a1,stroke:#333,color:#fff;
classDef db fill:#6c5ce7,stroke:#333,color:#fff;
classDef cache fill:#ff6b6b,stroke:#333,color:#000;
classDef auth fill:#fdd835,stroke:#333,color:#000;

class FE frontend;
class API backend;
```

ğŸ”¹ 3. Backend â†’ API Externa e Banco Externo

```{mermaid}
flowchart LR
    API["ğŸ”§ Backend"] --> DBI(("ğŸ—„ï¸ DB Interno"))
    API --> Bridge["ğŸ”— DataBridge"]
    Bridge --> Ext["ğŸ§© API Externa"]
    Ext --> DBE(("ğŸ—„ï¸ DB Externo"))

%% Estilos padronizados
classDef user fill:#f5f5f5,stroke:#333,color:#000;
classDef frontend fill:#61dafb,stroke:#333,color:#000;
classDef backend fill:#68a063,stroke:#333,color:#000;
classDef external fill:#4479a1,stroke:#333,color:#fff;
classDef db fill:#6c5ce7,stroke:#333,color:#fff;
classDef cache fill:#ff6b6b,stroke:#333,color:#000;
classDef auth fill:#fdd835,stroke:#333,color:#000;

class API backend;
class Bridge,Ext external;
class DBI,DBE db;
```

## 3.4 Sequence Diagram

```{mermaid}
sequenceDiagram
    participant U as ğŸ§‘ UsuÃ¡rio
    participant FE as ğŸŒ Frontend
    participant BE as ğŸ”§ Backend
    participant DBI as ğŸ—„ï¸ Banco Interno
    participant APIEXT as ğŸ§© API Externa
    participant DBEXT as ğŸ—„ï¸ Banco Externo

    U->>FE: Acessa o site
    FE->>FE: Atualiza estado

    FE->>BE: RequisiÃ§Ã£o de dados
    BE->>BE: Valida / autentica

    BE->>DBI: Consulta dados locais
    DBI-->>BE: Retorno interno

    BE->>APIEXT: Solicita dados externos
    APIEXT->>DBEXT: Consulta base externa
    DBEXT-->>APIEXT: Retorno externo
    APIEXT-->>BE: Dados externos

    BE-->>FE: Resposta final JSON
    FE->>U: Renderiza UI
```

## 3.5 Resumo TÃ©cnico do Fluxo

O usuÃ¡rio acessa o navegador.

O servidor entrega o front-end estÃ¡tico.

O front-end consulta apenas a API interna.

O backend processa tudo e acessa:
    banco interno,
    API externa,
    cache,
    futuros mÃ³dulos (ex.: pagamento).

O back retorna dados limpos e unificados.

O frontend atualiza tudo de forma reativa.

## 3.6 DecisÃµes Arquiteturais Essenciais

ğŸ” SeguranÃ§a: o frontend nunca acessa o sistema externo diretamente.

ğŸ”„ Cache: reduz carga sobre o sistema legado.

ğŸ§± Backend como camada de proteÃ§Ã£o: valida, transforma e agrega dados.

ğŸ“¦ Hospedagem compartilhada: exige build estÃ¡tico e backend leve.

ğŸ“˜ DocumentaÃ§Ã£o: tudo em Markdown + Mermaid.
